html
  head
    title RepoSense Report
    link(rel="stylesheet", href="https://fonts.googleapis.com/css?family=Titillium+Web")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/normalize.css@8.0/normalize.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/muicss@0.9/dist/css/mui.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/highlight.js@9.14/styles/color-brewer.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/vue-loading-spinner@1.0/dist/vue-loading-spinner.css")
    link(rel="stylesheet", href="static/css/style.css")

    script(src="https://use.fontawesome.com/releases/v5.0.13/js/all.js", defer=True)
    script(src="https://cdn.jsdelivr.net/npm/vue@2.5/dist/vue.min.js")
    script(src="https://cdn.jsdelivr.net/npm/jszip@3.1/dist/jszip.min.js")

    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/highlight.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/asciidoc.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/gradle.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/plaintext.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/scss.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/yaml.min.js")
    script(src="https://cdn.jsdelivr.net/npm/vue-loading-spinner@1.0/dist/vue-loading-spinner.js")
  body
    div#app
      #app-wrapper(v-if="userUpdated", onmousemove="mouseMove(event)",
        onmouseup="deregisterMouseMove()", onmouseleave="deregisterMouseMove()")
        #tab-resize-guide
        #summary-wrapper
          .summary-status(v-if="loadedRepo<repoLength") Loading repos ... {{ loadedRepo }} / {{ repoLength }}
          v_summary(
            v-bind:repos="getUsers()",
            v-on:view-authorship="updateTabAuthorship",
            v-on:get-dates="receiveDates"
          )
          .timestamp-footer
            span Generated by &nbsp;
            a(
              v-bind:href="getRepoSenseLink()", target="_blank",
            )
              strong RepoSense {{ repoSenseVersion }}
            span &nbsp; on {{ creationDate }}

        #tabs-wrapper(v-if="isTabActive")
          #tab-resize(onmousedown="registerMouseMove()")
          .tab-close(v-on:click="isTabActive=false")
            i.fas.fa-caret-right
          .tab-content
            .tab-panes
              v_authorship#tab-authorship.tab-pane(
                v-if="tabType === 'authorship'"
                v-bind:key="generateKey(tabInfo.tabAuthorship)",
                v-bind:info="tabInfo.tabAuthorship")
              #tab-empty.tab-pane(v-else)
                .title
                  span To view the code attributed to a specific author, click the &nbsp;
                  i.fas.fa-code
                  span &nbsp; icon next to that author's name.
                  br
                  span To hide the code view, click the &nbsp;
                  i.fas.fa-caret-right
                  span &nbsp; icon on the left.

      template(v-else)
        .empty please enter a report directory or upload a report zip

        form#file-upload(onsubmit="return false;")
          input(type="file", v-on:change="updateReportZip")
          .loader(v-if="isLoading")
            circle-spinner
            .loading Loading resources...

    vuetemplate#v_summary
      #summary.wrapper
        form.summary-picker.mui-form--inline(v-on:submit.prevent="getFiltered();")
          .summary-picker__section
            .mui-textfield
              input.summary-picker__search(type="text", v-on:change="updateFilterSearch", v-model="filterSearch")
              label search
            .mui-select.grouping
              select(v-model="filterGroupSelection")
                option(value="groupByNone") None
                option(value="groupByRepos") Repo/Branch
                option(value="groupByAuthors") Author
              label group by
            .mui-select.sort-group
              select(v-model="sortGroupSelection")
                option(value="name", v-if="filterGroupSelection !== 'groupByRepos'") &uarr; name
                option(value="name dsc", v-if="filterGroupSelection !== 'groupByRepos'") &darr; name
                option(value="searchPath", v-if="filterGroupSelection !== 'groupByAuthors'") &uarr; repo/branch
                option(value="searchPath dsc", v-if="filterGroupSelection !== 'groupByAuthors'") &darr; repo/branch
                option(value="totalCommits") &uarr; contribution
                option(value="totalCommits dsc") &darr; contribution
                option(value="variance") &uarr; variance
                option(value="variance dsc") &darr; variance
              label sort groups by
            .mui-select.sort-within-group
              select(v-model="sortWithinGroupSelection")
                option(value="name", v-if="filterGroupSelection === 'groupByRepos'") &uarr; name
                option(value="name dsc", v-if="filterGroupSelection === 'groupByRepos'") &darr; name
                option(value="searchPath", v-if="filterGroupSelection === 'groupByAuthors'") &uarr; repo/branch
                option(value="searchPath dsc", v-if="filterGroupSelection === 'groupByAuthors'") &darr; repo/branch
                option(value="totalCommits", v-if="filterGroupSelection !== 'groupByNone'") &uarr; contribution
                option(value="totalCommits dsc", v-if="filterGroupSelection !== 'groupByNone'") &darr; contribution
                option(value="variance", v-if="filterGroupSelection !== 'groupByNone'") &uarr; variance
                option(value="variance dsc", v-if="filterGroupSelection !== 'groupByNone'") &darr; variance
                option(value="", v-if="filterGroupSelection === 'groupByNone'", style="display:none") —— N/A ——
              label sort within groups by
            .mui-select
              select(v-model="filterTimeFrame")
                option(value="commit") Commit
                option(value="day") Day
                option(value="week") Week
              label granularity
          .summary-picker__section
            .mui-textfield.summary-picker__date
              input(type="date", v-model="tmpFilterSinceDate", onkeydown="return false",
                v-bind:min="minDate", v-bind:max="filterUntilDate")
              label since
            .mui-textfield.summary-picker__date
              input(type="date", v-model="tmpFilterUntilDate", onkeydown="return false",
                v-bind:min="filterSinceDate", v-bind:max="maxDate")
              label until
          .summary-picker__checkboxes.summary-picker__section
            label
              input(type="checkbox", v-model="filterBreakdown").mui-checkbox.summary-picker__checkbox
              span breakdown by file format
        #summary-charts
          .summary-charts(v-for="repo of filteredRepos")
            .summary-charts__title(v-if="filterGroupSelection === 'groupByRepos'") {{ repo[0].repoName }}
            .summary-charts__title(v-if="filterGroupSelection === 'groupByAuthors'") {{ repo[0].displayName }} ({{ repo[0].name }})
            .summary-charts__fileformat--breakdown(v-if="filterBreakdown")
              template(v-if="filterGroupSelection === 'groupByRepos'")
                .summary-charts__fileformat--breakdown__legend(
                    v-for="fileFormat in Object.keys(repo[0].fileFormatContribution)")
                  i.fas.fa-circle(
                      v-bind:style="{ 'color' : contributionBarColors[fileFormat] }"
                  )
                  span &nbsp; {{ fileFormat }} &nbsp;
              template(v-else)
                .summary-charts__fileformat--breakdown__legend(
                    v-for="fileFormat in Object.keys(contributionBarColors)")
                  i.fas.fa-circle(
                      v-bind:style="{ 'color' : contributionBarColors[fileFormat] }"
                  )
                  span &nbsp; {{ fileFormat }} &nbsp;
            .summary-chart(v-for="(user, i) in repo")
              .summary-chart__title
                .summary-chart__title--index {{ i+1 }}
                .summary-chart__title--repo(v-if="filterGroupSelection === 'groupByNone'") {{ user.repoName }}
                .summary-chart__title--author-repo(v-if="filterGroupSelection === 'groupByAuthors'") {{ user.repoName }}
                .summary-chart__title--name(v-if="filterGroupSelection !== 'groupByAuthors'") {{ user.displayName }}
                a(
                  title="click to view author's code",
                  v-on:click="$emit('view-authorship', \
                      {author:user.name, repo:user.repoName, name:user.displayName, location:repo[i].location, \
                          minDate:minDate, maxDate:maxDate})"
                )
                  i.summary-chart__title--button.fas.fa-code
                a(
                  v-bind:href="repo[i].location", target="_blank",
                  title="click to view author's repo"
                )
                  i.summary-chart__title--button.fab.fa-github
              .summary-chart__ramp
                template(v-if="filterTimeFrame === 'commit'")
                    template(v-for="(slice, j) in user.commits")
                      a.summary-chart__ramp__slice(
                        v-for="(commit, k) in slice.commitResults",
                        v-if="commit.insertions>0",
                        v-bind:href="getSliceLink(user, slice)", target="_blank",
                        v-bind:title="`[${slice.date}] ${commit.message}: ${commit.insertions} lines`",
                        v-bind:class="'summary-chart__ramp__slice--color' + getSliceColor(slice.date)",
                        v-bind:style="{\
                            zIndex: user.commits.length - j,\
                            borderLeftWidth: getWidth(commit) + 'em',\
                            right: ((getSlicePos(slice.date, filterSinceDate, filterUntilDate)\
                                + (getCommitPos(k, slice.commitResults.length, filterSinceDate, filterUntilDate))) * 100) + '%'\
                        }"
                      )

                template(v-else)
                  a.summary-chart__ramp__slice(
                    v-for="(slice, j) in user.commits",
                    v-if="slice.insertions > 0",
                    v-bind:title="`[${slice.date}] ${filterTimeFrame === 'day' ? 'Daily' : 'Weekly'} contribution: ${slice.insertions} lines`",
                    v-bind:href="getSliceLink(user, slice)", target="_blank",
                    v-bind:class="'summary-chart__ramp__slice--color' + getSliceColor(slice.date)",
                    v-bind:style="{\
                      zIndex: user.commits.length - j,\
                      borderLeftWidth: getWidth(slice) + 'em',\
                      right: (getSlicePos(slice.date, filterSinceDate, filterUntilDate) * 100) + '%'\
                    }"
                  )
              .summary-chart__contribution
                template(v-if="filterBreakdown")
                  .summary-chart__contrib(
                      v-for="(widths, fileFormat) in getFileFormatContributionBars(user.fileFormatContribution)"
                  )
                    .summary-chart__contrib--bar--fileformat(
                        v-for="width in widths",
                        v-bind:style="{ width: width + '%',\
                            'background-color': contributionBarColors[fileFormat] }",
                        v-bind:title="fileFormat + ': ' + user.fileFormatContribution[fileFormat] + ' lines, '\
                            + 'total: ' + user.totalCommits + ' lines ' + '(contribution from ' + minDate + ' to '\
                            + maxDate + ')'"
                    )
                template(v-else)
                  .summary-chart__contrib(
                      v-bind:title="'Total contribution from ' + minDate + ' to ' + maxDate + ': '\
                          + user.totalCommits + ' lines'"
                  )
                    .summary-chart__contrib--bar(
                        v-for="width in getContributionBars(user.totalCommits)",
                        v-bind:style="{ width: width+'%' }"
                    )

    vuetemplate#v_authorship
      #authorship
        .toolbar(v-if="hasCommits(info)")
            a(v-if="activeFilesCount === 0", v-on:click="expandAll(true)") Expand all
            a(v-else, v-on:click="expandAll(false)") Collapse all
        .title
          a.repoName(
            v-bind:href="info.location", target="_blank",
            v-bind:title="'Click to open the repo'"
          ) {{ info.repo }}
          .author {{ info.name }} ({{ info.author }}) contribution from {{ info.minDate }} to {{ info.maxDate }}
          .contribution(v-if="isLoaded && files.length!=0")
            .searchbox
              input.radio-button--search(type="radio", name="filter", value="search", v-bind:checked="isSearchBar",
                  v-on:click="indicateSearchBar")
              form.file-picker.mui-form--inline(onsubmit="return false")
                input#search(type="search", placeholder="Filter by glob", v-on:change="updateFilterSearch",
                    v-on:click="indicateSearchBar")
                button#submit-button(type="submit", v-on:click="indicateSearchBar") Filter
            .fileformat
              input.radio-button--checkbox(type="radio", name="filter", value="checkboxes", v-bind:checked="isCheckBoxes",
                  v-on:click="indicateCheckBoxes")
              div.checkboxes.mui-form--inline(v-if="files.length > 0")
                label
                  input.mui-checkbox--fileformat(type="checkbox" v-on:click="selectAll" v-model="isSelectAllChecked")
                  span(v-bind:title="getTotalFileBlankLineInfo()")
                    span.select All:&nbsp;
                    span.loc {{ totalLineCount }}&nbsp;
                    span.bloc ({{ totalBlankLineCount }})
                template(v-for="format in Object.keys(getExistingLinesObj)", v-bind:key="format")
                  label
                    input.mui-checkbox--fileformat(type="checkbox" v-bind:checked="selectedFileFormats.includes(format)"
                        v-on:change="selectFileFormat(format)")
                    span(v-bind:title="getFileBlankLineInfo(format)")
                      span {{ format }}: {{ getExistingLinesObj[format] }}&nbsp;
                      span.bloc ({{ filesBlankLinesObj[format] }})
            .sorting.mui-form--inline
              .mui-select
                select(v-model="filesSortType")
                  option(value="lineOfCode") LoC
                  option(value="path") Path
                  option(value="fileName") File Name
                  option(value="fileType") File Format
                label sort by
              label
                input(type="checkbox", v-model="toReverseSortFiles").mui-checkbox
                span reverse

        .files(v-if="isLoaded")
          .empty(v-if="files.length === 0") nothing to see here :(
          template(v-for="file in selectedFiles")
            .file.active(v-bind:key="file.path")
              .title
                span.path(onclick="toggleNext(this.parentNode)", v-on:click="updateCount") {{ file.path }}&nbsp;
                span.loc ({{ file.lineCount }} lines)
                a(
                  v-bind:href="getFileLink(file, 'commits')", target="_blank",
                  title="click to view the history view of file"
                )
                  i.button.fas.fa-history
                a(
                  v-bind:href="getFileLink(file, 'blame')", target="_blank",
                  title="click to view the blame view of file"
                )
                  i.button.fas.fa-user-edit
              pre.hljs
                div(v-hljs="file.path")
                  template(v-for="segment in file.segments")
                    .segment(v-bind:class="{ untouched: !segment.authored, active: segment.lines.length<5 }")
                      .closer(v-if="!segment.authored && segment.lines.length>4", onclick="toggleNext(this)")
                        i.fas.fa-ellipsis-h.icon
                        span.tooltiptext.tooltiptext--close Show untouched code
                        span.tooltiptext.tooltiptext--open Hide untouched code
                      .code {{ segment.lines.join("\n") }}
        .empty(v-else) loading...

    script(src="static/js/api.js")
    script(src="static/js/v_summary.js")
    script(src="static/js/v_authorship.js")
    script(src="static/js/main.js")
