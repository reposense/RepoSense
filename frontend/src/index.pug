html
  head
    title RepoSense Report
    link(rel="shortcut icon" type="image/x-icon" href="favicon.ico")
    link(rel="stylesheet", href="https://fonts.googleapis.com/css?family=Titillium+Web")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/normalize.css@8.0/normalize.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/muicss@0.9/dist/css/mui.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/highlight.js@9.14/styles/color-brewer.min.css")
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/vue-loading-spinner@1.0/dist/vue-loading-spinner.css")
    link(rel="stylesheet", href="static/css/style.css")

    script(src="https://use.fontawesome.com/releases/v5.0.13/js/all.js", defer=True)
    script(src="https://cdn.jsdelivr.net/npm/vue@2.5/dist/vue.js")
    script(src="https://cdn.jsdelivr.net/npm/jszip@3.1/dist/jszip.min.js")

    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/highlight.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/asciidoc.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/gradle.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/plaintext.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/scss.min.js")
    script(src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.14/build/languages/yaml.min.js")
    script(src="https://cdn.jsdelivr.net/npm/vue-loading-spinner@1.0/dist/vue-loading-spinner.js")
  body
    div#app
      #app-wrapper(v-if="userUpdated", onmousemove="mouseMove(event)",
        onmouseup="deregisterMouseMove()", onmouseleave="deregisterMouseMove()")
        #tab-resize-guide
        #summary-wrapper
          .summary-status(v-if="loadedRepo<repoLength") Loading repos ... {{ loadedRepo }} / {{ repoLength }}
          v_summary(
            ref="summary",
            v-bind:repos="users",
            v-bind:error-messages="errorMessages",
            v-on:view-zoom="updateTabZoom",
            v-on:view-authorship="updateTabAuthorship",
            v-on:get-dates="receiveDates"
          ).tab-padding
          .timestamp-footer
            span Generated by&nbsp;
            a(
              v-bind:href="getRepoSenseHomeLink()", target="_blank",
            )
              strong RepoSense
            span &nbsp;(
            a(
              v-bind:href="getRepoSenseVersionLink()", target ="_blank",
            )
              strong {{ repoSenseVersion }}
            span ) on {{ creationDate }}

        #tabs-wrapper(v-if="isTabActive")
          #tab-resize(onmousedown="registerMouseMove()")
          .tab-close(v-on:click="deactivateTab")
            i.fas.fa-caret-right
          .tab-content.tab-padding
            .tab-panes
              v_authorship#tab-authorship.tab-pane(
                v-if="tabType === 'authorship'"
                v-bind:key="generateKey(tabInfo.tabAuthorship)",
                v-bind:info="tabInfo.tabAuthorship")
              v_zoom#tab-zoom.tab-pane(
                v-else-if="tabType === 'zoom'",
                v-bind:key="generateKey(tabInfo.tabZoom)",
                v-bind:info="tabInfo.tabZoom",
                v-on:view-summary="updateSummaryDates")
              #tab-empty.tab-pane(v-else)
                .title
                  span To view the code attributed to a specific author, click the &nbsp;
                  i.fas.fa-code
                  span &nbsp; icon next to that author's name.
                  br
                  span To hide the code view, click the &nbsp;
                  i.fas.fa-caret-right
                  span &nbsp; icon on the left.

      template(v-else)
        .empty Please upload a .zip file generated by RepoSense.

        form#file-upload(onsubmit="return false;")
          input(type="file", accept=".zip", v-on:change="updateReportZip")
          .loader(v-if="isLoading")
            circle-spinner
            .loading Loading resources...

    vuetemplate#v_summary
      #summary.wrapper
        form.summary-picker.mui-form--inline(onsubmit="return false;")
          .summary-picker__section
            .mui-textfield
              input.summary-picker__search(type="text", v-on:change="updateFilterSearch", v-model="filterSearch")
              label search
            .mui-select.grouping
              select(v-model="filterGroupSelection")
                option(value="groupByNone") None
                option(value="groupByRepos") Repo/Branch
                option(value="groupByAuthors") Author
              label group by
            .mui-select.sort-group
              select(v-model="sortGroupSelection")
                option(value="groupTitle") &uarr; group title
                option(value="groupTitle dsc") &darr; group title
                option(value="totalCommits") &uarr; contribution
                option(value="totalCommits dsc") &darr; contribution
                option(value="variance") &uarr; variance
                option(value="variance dsc") &darr; variance
              label sort groups by
            .mui-select.sort-within-group
              select(
                  v-model="sortWithinGroupSelection",
                  v-bind:disabled="filterGroupSelection === 'groupByNone' || isMergeGroup"
              )
                option(value="title") &uarr; title
                option(value="title dsc") &darr; title
                option(value="totalCommits") &uarr; contribution
                option(value="totalCommits dsc") &darr; contribution
                option(value="variance") &uarr; variance
                option(value="variance dsc") &darr; variance
              label sort within groups by
            .mui-select
              select(v-model="filterTimeFrame")
                option(value="commit") Commit
                option(value="day") Day
                option(value="week") Week
              label granularity
            .mui-textfield.summary-picker__date
              input(v-if="isSafariBrowser", type="text", placeholder="yyyy-mm-dd",
                  v-bind:value="filterSinceDate", v-on:keyup.enter="updateTmpFilterSinceDate",
                  onkeydown="formatInputDateOnKeyDown(event)", oninput="appendDashInputDate(event)", maxlength=10)
              input(v-else, type="date", v-bind:value="filterSinceDate", v-on:input="updateTmpFilterSinceDate",
                  onkeydown="return false", v-bind:min="minDate", v-bind:max="filterUntilDate")
              label since
            .mui-textfield.summary-picker__date
              input(v-if="isSafariBrowser", type="text", placeholder="yyyy-mm-dd",
                  v-bind:value="filterUntilDate", v-on:keyup.enter="updateTmpFilterUntilDate",
                  onkeydown="formatInputDateOnKeyDown(event)", oninput="appendDashInputDate(event)", maxlength=10)
              input(v-else, type="date", v-bind:value="filterUntilDate", v-on:input="updateTmpFilterUntilDate",
                  onkeydown="return false", v-bind:min="filterSinceDate", v-bind:max="maxDate")
              label until
            .mui-textfield.summary-picker__date
              a(v-on:click="resetDateRange") Reset date range
            .summary-picker__checkboxes.summary-picker__section
              label
                input(type="checkbox", v-model="filterBreakdown", v-on:change="setSummaryHash()").mui-checkbox.summary-picker__checkbox
                span breakdown by file type
              label.merge-group(v-bind:style="filterGroupSelection === 'groupByNone' ? { opacity:0.5 } : { opacity:1.0 }")
                input(
                    type="checkbox",
                    v-model="isMergeGroup",
                    v-bind:disabled="filterGroupSelection === 'groupByNone'"
                ).mui-checkbox.summary-picker__checkbox
                span merge group
        .error-message-box(v-if="Object.entries(errorMessages).length")
          .error-message-box__close-button(onclick="dismissTab(this)") &times;
          .error-message-box__message The following issues occurred when analyzing the following repositories:
          .error-message-box__failed-repo(v-for="errorBlock in errorMessages")
            i.fas.fa-exclamation.mini-font
            span.error-message-box__failed-repo--name {{ errorBlock.repoName }}
            div.error-message-box__failed-repo--reason(v-if="errorBlock.errorMessage.startsWith('Unexpected error stack trace')")
              span Oops, an unexpected error occurred. If you think this is due to a problem in RepoSense, please report in&nbsp;
              a(
                v-bind:href="getReportIssueGitHubLink(errorBlock.errorMessage)", target="_blank",
              )
                strong our issue tracker&nbsp;
              span or email us at&nbsp;
              a(
                v-bind:href="getReportIssueEmailLink(errorBlock.errorMessage)"
              )
                span {{ getReportIssueEmailAddress() }}
            div.error-message-box__failed-repo--reason(v-else) {{ errorBlock.errorMessage }}
        #summary-charts
          .summary-charts(v-for="(repo, i) in filteredRepos")
            .summary-charts__title(v-if="filterGroupSelection === 'groupByRepos'")
              .summary-charts__title--index {{ i+1 }}
              .summary-charts__title--repo {{ repo[0].repoName }}
              .summary-charts__title--contribution.mini-font(title="Total contribution of group") [{{ getGroupTotalContribution(repo) }} lines]
            .summary-charts__title(
                v-if="filterGroupSelection === 'groupByAuthors'",
                v-bind:class="{ warn: repo[0].name === '-' }"
            )
              .summary-charts__title--index {{ i+1 }}
              .summary-charts__title--repo {{ repo[0].displayName }} ({{ repo[0].name }})
              .summary-charts__title--contribution.mini-font(title="Total contribution of group") [{{ getGroupTotalContribution(repo) }} lines]
            .summary-charts__fileType--breakdown(v-if="filterBreakdown")
              template(v-if="filterGroupSelection === 'groupByRepos'")
                .summary-charts__fileType--breakdown__legend(
                    v-for="fileType in getFileTypes(repo)")
                  i.fas.fa-circle(
                      v-bind:style="{ 'color' : contributionBarFileTypeColors[fileType] }"
                  )
                  span &nbsp; {{ fileType }} &nbsp;
              template(v-else)
                .summary-charts__fileType--breakdown__legend(
                    v-for="fileType in Object.keys(contributionBarFileTypeColors)")
                  i.fas.fa-circle(
                      v-bind:style="{ 'color' : contributionBarFileTypeColors[fileType] }"
                  )
                  span &nbsp; {{ fileType }} &nbsp;
            .summary-chart(v-for="(user, i) in repo")
              .summary-chart__title(v-if="!isMergeGroup")
                .summary-chart__title--index {{ i+1 }}
                .summary-chart__title--repo(v-if="filterGroupSelection === 'groupByNone'") {{ user.repoName }}
                .summary-chart__title--author-repo(v-if="filterGroupSelection === 'groupByAuthors'") {{ user.repoName }}
                .summary-chart__title--name(
                    v-if="filterGroupSelection !== 'groupByAuthors'",
                    v-bind:class="{ warn: user.name === '-' }"
                ) {{ user.displayName }} ({{ user.name }})
                .summary-chart__title--contribution.mini-font [{{ user.totalCommits }} lines]
                a(
                  title="click to view author's code",
                  onclick="deactivateAllOverlays()",
                  v-on:click="openTabAuthorship(user, repo, i)"
                )
                  i.summary-chart__title--button.fas.fa-code
                a(
                  v-bind:href="getRepoLink(repo[i])", target="_blank",
                  title="click to view author's repo"
                )
                  i.summary-chart__title--button.fab.fa-github
                a(
                  title="click to view breakdown of commits",
                  onclick="deactivateAllOverlays()",
                  v-on:click="openTabZoom(user, filterSinceDate, filterUntilDate, repo, i)"
                )
                  i.summary-chart__title--button.fas.fa-list-ul
              .summary-chart__ramp(
                onclick="viewClick(event)",
                v-on:click="openTabZoomSubrange(user, repo, i)"
              )
                v_ramp(
                    v-bind:groupby="filterGroupSelection",
                    v-bind:user="user",
                    v-bind:tframe="filterTimeFrame",
                    v-bind:sdate="filterSinceDate",
                    v-bind:udate="filterUntilDate",
                    v-bind:avgsize="avgCommitSize",
                    v-bind:mergegroup="isMergeGroup")
                .overlay

              .summary-chart__contribution
                template(v-if="filterBreakdown")
                  .summary-chart__contrib(
                      v-for="(widths, fileType) in getFileTypeContributionBars(user.fileTypeContribution)"
                  )
                    .summary-chart__contrib--bar(
                        v-for="width in widths",
                        v-bind:style="{ width: width + '%',\
                            'background-color': contributionBarFileTypeColors[fileType] }",
                        v-bind:title="fileType + ': ' + user.fileTypeContribution[fileType] + ' lines, '\
                            + 'total: ' + user.totalCommits + ' lines ' + '(contribution from ' + minDate + ' to '\
                            + maxDate + ')'"
                    )
                template(v-else)
                  .summary-chart__contrib(
                      v-bind:title="'Total contribution from ' + minDate + ' to ' + maxDate + ': '\
                          + user.totalCommits + ' lines'"
                  )
                    .summary-chart__contrib--bar(
                        v-for="width in getContributionBars(user.totalCommits)",
                        v-bind:style="{ width: width+'%' }"
                    )

    vuetemplate#v_ramp
      include ramp.pug

    vuetemplate#v_zoom
      include tabs/zoom.pug

    vuetemplate#v_segment
      include tabs/segment.pug

    vuetemplate#v_authorship
      include tabs/authorship.pug

    script(src="static/js/api.js")
    script(src="static/js/safari_date.js")
    script(src="static/js/v_ramp.js")
    script(src="static/js/v_zoom.js")
    script(src="static/js/v_segment.js")
    script(src="static/js/v_summary.js")
    script(src="static/js/v_authorship.js")
    script(src="static/js/main.js")
